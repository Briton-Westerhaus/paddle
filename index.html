<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Paddle</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="main.css" />
    <style>
        body {
            width: 100%;
            height: 100%;
            position: relative;
        }
        #theGame{
            margin-left: auto;
            margin-right: auto;
            display: block;
            background-color: white;
            border: 1px solid black;
            cursor: none;
        }
        p.header{
            font-size: 1.5em;
            font-weight: bold;
            width: 90%;
            margin-left: auto;
            margin-right: auto;
            font-family: Arial, Helvetica, sans-serif;
        }
    </style>
    <script src="main.js"></script>
    <script type="text/javascript">
        var theGame;
        var context;
        var width;
        var height;
        var elev;
        var speed;
        var charPos;
        var ballPos;
        var interval;
        var rect;
        var bounces;
        var bounceCount;

        window.onload = function() {
            bounceCount = document.getElementById("BounceCount");
            
            theGame = document.getElementById("theGame");
            width = window.innerWidth * .9;
            height = window.innerHeight * .8;
            theGame.width = width;
            theGame.height = height;

            context = theGame.getContext("2d");

            interval = null;

            document.addEventListener("keydown", function(evt) {
                if (evt.keyCode == 32)
                    window.clearInterval(interval);
            });

            document.addEventListener("click", function(evt) {
                if (interval == null) {
                    newGame();
                    interval =  window.setInterval(tick, 50);
                }
            });

            document.addEventListener("mousemove", function(evt) {
                clearPaddle();
                charPos = getMousePos(theGame, evt);
                drawPaddle();
                drawBall(ballPos.x, ballPos.y, elev);
            });

            newGame();
        }

        function newGame(){
            if (charPos)
               clearPaddle();
            if (ballPos)
                clearBall(ballPos.x, ballPos.y, elev);
            bounceCount.innerHTML = bounces = 0;
            elev = 0;
            speed = {
                x: 0,
                y: 0,
                z: 10
            };

            charPos = {
                x: width / 2,
                y: height / 2
            };

            ballPos = {
                x: width / 2,
                y: height / 2
            };
        }

        function getMousePos(canvas, evt) {
            rect = canvas.getBoundingClientRect();
            return {
                x: evt.clientX - rect.left,
                y: evt.clientY - rect.top
            };
        }

        function clearBall(x, y, elev) {
            context.clearRect(x - (10 + elev * .7), y - (10 + elev * .7), 20 + elev * 1.4, 20 + elev * 1.4);
        }

        function drawBall(x, y, elev) {
            var radius = 10 + elev * .7;
            var grd = context.createRadialGradient(x - radius / 4, y - radius / 4, radius / 10, x - radius / 4, y - radius / 4, radius);
            context.strokeStyle = "rgba(0, 0, 0, 0)";
            grd.addColorStop(0, "white");
            grd.addColorStop(1, "lightgray");
            context.fillStyle = grd;
            context.beginPath();
            context.arc(x, y, radius, 0, 2 * Math.PI);
            context.closePath();
            context.fill();
        }
        
        function clearPaddle() {
            context.strokeStyle = "rgba(0, 0, 0, 0)";
            context.fillStyle = "white";
            context.fillRect(charPos.x - 76, charPos.y - 76, 152, 152);
        }

        function drawPaddle() {
            context.strokeStyle = "black";
            context.strokeRect(charPos.x - 75, charPos.y - 75, 150, 150);
            context.fillStyle = "rgb(200, 215, 255)";
            context.fillRect(charPos.x - 75, charPos.y - 75, 150, 150);
            context.beginPath();
            context.moveTo(charPos.x - 75, charPos.y);
            context.lineTo(charPos.x + 75, charPos.y);
            context.moveTo(charPos.x, charPos.y - 75);
            context.lineTo(charPos.x, charPos.y + 75);
            context.closePath();
            context.stroke();
            context.beginPath();
            context.arc(charPos.x, charPos.y, 10, 0, 2 * Math.PI);
            context.closePath();
            context.stroke();
            context.fill();
        }

        function lose() {
            window.clearInterval(interval);
            interval = null;
            alert("You lost!");
        }

        function tick() {
            clearBall(ballPos.x, ballPos.y, elev);
            drawPaddle();
            elev += speed.z;
            ballPos.x += speed.x;
            ballPos.y += speed.y;
            if (elev <= 0 && speed.z < 0) {
                if (Math.abs(charPos.x - ballPos.x) <= 75 && Math.abs(charPos.y - ballPos.y) <= 75) { //Bounce!
                    speed.z = 0 - speed.z;
                    if (ballPos.x == charPos.x)
                        speed.x += Math.random() > .5 ? 1 : -1;
                    else
                        speed.x += Math.round((ballPos.x - charPos.x) / 2);
                    if (ballPos.y == charPos.y)
                        speed.y += Math.random() > .5 ? 1 : -1;
                    else
                        speed.y += Math.round((ballPos.y - charPos.y) / 2);
                    bounces++;
                    bounceCount.innerHTML = bounces;
                } else //Lost Game!
                    lose();
            } else
                speed.z -= 1;
            if (ballPos.x <= 0) {
                ballPos.x = Math.abs(ballPos.x);
                speed.x = 0 - speed.x;
            } else if (ballPos.x >= rect.width) {
                ballPos.x = 2 * rect.width - ballPos.x;
                speed.x = 0 - speed.x;
            }

            if (ballPos.y <= 0) {
                ballPos.y = Math.abs(ballPos.y);
                speed.y = 0 - speed.y;
            } else if (ballPos.y >= rect.height) {
                ballPos.y = 2 * rect.height - ballPos.y;
                speed.y = 0 - speed.y;
            }
            drawBall(ballPos.x, ballPos.y, elev);

        }
    </script>
</head>
<body>
    <p class="header">Bounces: <span id="BounceCount"></span></p>
    <canvas id="theGame" width=500 height=500></canvas>
</body>
</html>