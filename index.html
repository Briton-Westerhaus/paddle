<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Paddle</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="main.css" />
    <style>
        body {
            width: 100%;
            height: 100%;
            position: relative;
        }
        #theGame{
            margin-left: auto;
            margin-right: auto;
            display: block;
            background-color: lightgray;
        }
    </style>
    <script src="main.js"></script>
    <script type="text/javascript">
        var theGame;
        var context;
        var width;
        var height;
        var elev;
        var speed;
        var charPos;
        var ballPos;
        var interval;
        var rect;

        window.onload = function() {
            elev = 0;
            speed = {
                x: 0,
                y: 0,
                z: 10
            };
            theGame = document.getElementById("theGame");
            width = window.innerWidth * .9;
            height = window.innerHeight * .9;
            theGame.width = width;
            theGame.height = height;

            charPos = {
                x: width / 2,
                y: height / 2
            };

            ballPos = {
                x: width / 2,
                y: height / 2
            };

            context = theGame.getContext("2d");

            interval = window.setInterval(tick, 50);

            document.addEventListener("keydown", function(evt) {
                if (evt.keyCode == 32)
                    window.clearInterval(interval);
            });

            document.addEventListener("mousemove", function(evt) {
                clearPaddle();
                charPos = getMousePos(theGame, evt);
                drawPaddle();
                drawBall(ballPos.x, ballPos.y, elev);
            });
        }

        function getMousePos(canvas, evt) {
            rect = canvas.getBoundingClientRect();
            return {
                x: evt.clientX - rect.left,
                y: evt.clientY - rect.top
            };
        }

        function clearBall(x, y, elev) {
            context.clearRect(x - (10 + elev * .7), y - (10 + elev * .7), 20 + elev * 1.4, 20 + elev * 1.4);
        }

        function drawBall(x, y, elev) {
            context.fillStyle = "white";
            context.beginPath();
            context.arc(x, y, 10 + elev * .7, 0, 2 * Math.PI);
            context.fill();
        }
        
        function clearPaddle() {
            context.fillStyle = "lightgray";
            context.fillRect(charPos.x - 75, charPos.y - 75, 150, 150);
        }

        function drawPaddle() {
            context.fillStyle = "blue";
            context.fillRect(charPos.x - 75, charPos.y - 75, 150, 150);
        }

        function lose() {
            window.clearInterval(interval);
            alert("You lost!");
        }

        function tick() {
            clearBall(ballPos.x, ballPos.y, elev);
            drawPaddle();
            elev += speed.z;
            ballPos.x += speed.x;
            ballPos.y += speed.y;
            if (elev == 0 && speed.z < 0) {
                if (Math.abs(charPos.x - ballPos.x) <= 75 && Math.abs(charPos.y - ballPos.y) <= 75) { //Bounce!
                    speed.z = 0 - speed.z;
                    speed.x += Math.round((ballPos.x - charPos.x) / 2);
                    speed.x += Math.round((ballPos.y - charPos.y) / 2);
                } else //Lost Game!
                    lose();
            } else
                speed.z -= 1;
            drawBall(ballPos.x, ballPos.y, elev);
            if (ballPos.x < 0 || ballPos.y < 0 || ballPos.x > rect.width || ballPos.y > rect.height)
                lose();
        }
    </script>
</head>
<body>
    <canvas id="theGame" width=500 height=500>

    </canvas>
</body>
</html>